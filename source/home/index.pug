extends /_templates/layout.pug
include /_templates/mixins.pug

block content
    - var featured = self.data.performances.filter(e => e.front_page_promotion)
    .container-fluid
        .row
            if featured && featured.length
                section.event-banner.carousel.slide(id='front-carousel' data-ride='carousel')
                    .carousel-inner(role='listbox')
                        - var featureActive = 0
                        each performance in featured
                            - var carousel_url = performance[`name_${self.locale}`].includes('Baltoscandal') ? 'https://baltoscandal.ee' : (`/${lang_path}${performance.path}`)

                            .item(class=(featureActive++ === 0 ? 'active' : ''))
                                a(href=carousel_url)
                                    - var photoBig = performance.X_pictures && performance.X_pictures.photoBig ? performance.X_pictures.photoBig.split(',')[0] : '/assets/images/placeholder.jpg'
                                    figure(id=`slide-${performance.remote_id}`, style=`background-image: url('${f_api}${photoBig}');`)
                                    header.col-md-8
                                        if performance[`X_headline_${self.locale}`]
                                            p= performance[`X_headline_${self.locale}`]
                                        h1
                                            if performance.X_artist
                                                span.artist= performance.X_artist

                                            if performance.X_producer
                                                span.producer= performance.X_producer

                                            if performance[`X_town_${self.locale}`]
                                                span.town= performance[`X_town_${self.locale}`]
                                        h1= performance[`name_${self.locale}`]

                                        if performance[`subtitle_${self.locale}`]
                                            p= performance[`subtitle_${self.locale}`]

                                - var activeCategories = []
                                    if performance.categories
                                        - activeCategories = performance.categories.filter( e => e.featured_on_front_page).map( e => e.remote_id )
                                    ul.event-categories
                                        if self.data.categories
                                            each category in self.data.categories
                                                if category.featured_on_front_page
                                                    li.text-uppercase.h3( class =( activeCategories.includes(category.remote_id) ? "" : "unactive" ) )
                                                        span
                                                            a(href="")= category[`name_${self.locale}`]

                    a.left.carousel-control(href='#front-carousel' role='button' data-slide='prev')
                        span.icon-prev.arrow-left(aria-hidden='true')
                        span.sr-only Previous
                    a.right.carousel-control(href='#front-carousel' role='button' data-slide='next')
                        span.icon-next.arrow-right(aria-hidden='true')
                        span.sr-only Next

                    each performance in featured
                        script.
                            var gradientMap = '#000000, #FFC600';
                            var slide#{performance.remote_id} = document.getElementById('slide-#{performance.remote_id}');
                            GradientMaps.applyGradientMap(slide#{performance.remote_id}, gradientMap);

        .row.front-page-margin
            section.col-xs-12.col-md-12.col-lg-9

                - var listlength = 3
                .programme.row
                    .col-xs-12.col-md-12.col-lg-12
                        h2 Kava
                    - var currentDate = new Date()
                    - var pastTwoDays = new Date()
                    //- - var nextThreeDays = new Date()

                    - pastTwoDays.setDate(pastTwoDays.getDate() - 2)
                    //- - nextThreeDays.setDate(nextThreeDays.getDate() + 3)
                    //- - console.log(currentDate, ' - ', pastTwoDays, ' - ', nextThreeDays)

                    - var events = self.data.events.filter(e => new Date(e.start_time) > pastTwoDays)
                    //- each performance in
                    //- - console.log(events.map(a => a.start_time))

                    if events && events.length
                        each event in events
                            - var eventDate = new Date(event.start_time)
                            div(type-name="event" start_time=`${event.start_time}`)
                                .col-xs-12.col-sm-2.col-lg-2
                                    p
                                        +dayName(event.start_time)
                                    p
                                        +dateFull(event.start_time)
                                    //- Whole day event if 23:59
                                    if `${eventDate.getHours()}:${eventDate.getMinutes()}` !=='23:59'
                                        p
                                            +hoursMinutes(event.start_time)
                                    if event.canceled
                                        p.today JÄÄB ÄRA!

                                    if `${eventDate.getMonth()}.${eventDate.getDate()}` === `${currentDate.getMonth()}.${currentDate.getDate()}`
                                        p.today TÄNA!

                                .col-xs-12.col-md-6.col-lg-6
                                    h3
                                        a(href=`/${lang_path}performance/${event.performance_remote_id}`)
                                            span.subtitle Baltoscandal 2020 esitleb:
                                            span.artist Stefan Kaegi / Rimini Protokoll
                                            span.name !!JÄÄB ÄRA!! Uncanny Valley (Õõvaorg)
                                .col-xs-6.col-md-2.col-lg-2
                                    p.location Kanuti Gildi SAAL
                                    p 15/19 EUR
                                    p Kohapealt: 15/19 EUR€
                                .col-xs-6.col-md-2.col-lg-2.text-right
                                    a.btn.btn-primary(href="https://fienta.com/et/s/stefan-kaegi-rimini-protokoll-oovaorg-uncanny-valley" target="_blank") Osta pilet
                                .col-xs-12.col-md-12.col-lg-12
                                    hr
                            //- .col-xs-12.col-sm-2.col-lg-2
                            //-     p neljapäev
                            //-     p 03.12.2020
                            //-     p 20:30
                            //-     p.today Täna!
                            //- .col-xs-12.col-md-6.col-lg-6
                            //-     h3
                            //-         a(href="/et/performance/6858")
                            //-             span.subtitle Baltoscandal 2020 esitleb:
                            //-             span.artist Stefan Kaegi / Rimini Protokoll
                            //-             span.name !!JÄÄB ÄRA!! Uncanny Valley (Õõvaorg)
                            //- .col-xs-6.col-md-2.col-lg-2
                            //-     p.location Kanuti Gildi SAAL
                            //-     p 15/19 EUR
                            //-     p Kohapealt: 15/19 EUR€
                            //- .col-xs-6.col-md-2.col-lg-2.text-right
                            //-     a.btn.btn-primary(href="https://fienta.com/et/s/stefan-kaegi-rimini-protokoll-oovaorg-uncanny-valley" target="_blank") Osta pilet
                            //- .col-xs-12.col-md-12.col-lg-12
                            //-     hr
                            //- .col-xs-12.col-sm-2.col-lg-2
                            //-     p reede
                            //-     p 04.12.2020
                            //-     p 19:30
                            //- .col-xs-12.col-md-6.col-lg-6
                            //-     h3
                            //-         a(href="/et/performance/6894")
                            //-             span.name Kontsertsari IMPROTEST: SEEMNED / Improtest 15 Collective
                            //- .col-xs-6.col-md-2.col-lg-2
                            //-     p.location Kanuti Gildi SAAL
                            //-     p 5/8 EUR
                            //-     p Kohapealt: 5/8 EUR€
                            //- .col-xs-6.col-md-2.col-lg-2.text-right
                            //-     a.btn.btn-primary(href="https://fienta.com/et/kontsertsari-improtest-copeco-15632" target="_blank") Osta pilet
                            //- .col-xs-12.col-md-12.col-lg-12
                            //-     hr
                            //- .col-xs-12.col-sm-2.col-lg-2
                            //-     p laupäev
                            //-     p 05.12.2020
                            //-     p 19:30
                            //-     p.today Esietendus!
                            //- .col-xs-12.col-md-6.col-lg-6
                            //-     h3
                            //-         a(href="/et/performance/6865")
                            //-             span.artist Karolin Poska
                            //-             span.name Sinu nirvaanale
                            //- .col-xs-6.col-md-2.col-lg-2
                            //-     p.location Kanuti Gildi SAAL
                            //-     p 8/12 EUR
                            //-     p Kohapealt: 10/15 EUR€
                            //- .col-xs-6.col-md-2.col-lg-2.text-right
                            //-     a.btn.btn-primary.free.disabled(href="https://fienta.com/et/s/sinu-nirvaanale" target="_blank") Välja müüdud
                            //- .col-xs-12.col-md-12.col-lg-12
                            //-     hr
                    .col-xs-12.col-md-12
                        a.load-more.btn.btn-primary(href="/et/program/") Vaata kõiki
                .tour.row
                    .col-xs-12.col-md-12.col-lg-12
                        h2 Tuurid
            aside.col-xs-12.col-md-12.col-lg-3.sidebar
                .row
                    // .banner.col-xs-12.col-sm-6.col-md-4.col-lg-12
                    // a.text-center.h3.volunteer(href='https://saal.ee/et/festival/5663/program')= t('button.LATEST')
                    // .banner.col-xs-12.col-sm-6.col-md-4.col-lg-12
                    // a.text-center.h3.volunteer(href='https://saal.entu.ee/api2/file-6611')= t('button.NUPprint')
                    .hidden-xs.col-sm-6.col-md-4.col-lg-12.datepicker-container
                        h2 Kalender
                        #datepicker
                        ul.list-inline.legend
                            li.event SAALis
                            li.tour Tuuril
                    .banner.col-xs-12.col-sm-6.col-md-4.col-lg-12
                        a.text-center.h3.volunteer(href="contact#covid") Koroona meelespea
                    .banner.col-xs-12.col-sm-6.col-md-4.col-lg-12
                        a.text-center.h3.volunteer(href="mailto:vabatahtlik@saal.ee") Tule vabatahtlikuks!
                    #newsletter-sign-up.col-xs-12.col-sm-12.col-md-4.col-lg-12
                        p Liitu uudiskirjaga
                    #mailchimp-sign-up.col-xs-12.col-sm-12.col-md-4.col-lg-12
                        form#mc-embedded-subscribe-form.validate.validate(action="//saal.us9.list-manage.com/subscribe/post?u=b4d371ad73e2be3853f5cd989&amp;id=11b766323b" method="post" name="mc-embedded-subscribe-form" target="_blank" novalidate="")
                            .mc-field-group
                                input#mce-EMAIL.required.email(type="text" value="" name="EMAIL" placeholder="Sinu mailiaadress")
                            #mce-responses.clear
                                #mce-error-response.response(style="display:none")
                                #mce-success-response.response(style="display:none")
                            div(style="position: absolute; left: -5000px;")
                                input(type="text" name="b_1e1d48fe600fda5c3f6a39b75_fdc080b2d5" tabindex="-1" value="")
                            .clear
                                input#mc-embedded-subscribe.button(type="submit" value="OK!" name="subscribe")
